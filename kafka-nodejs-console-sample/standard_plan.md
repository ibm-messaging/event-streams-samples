# IBM Message Hub Kafka Node.js console sample application: Standard Plan deployment into IBM Cloud

## Prerequisites (IBM Cloud®)
* [Cloud Foundry Command Line Interface](https://github.com/cloudfoundry/cli/releases) installed

## Overview
To run the samples, you will:
* Setup your `manifest.yml` with your service details
* Use `ibmcloud cf push` to deploy and start the app to IBM Cloud®
* View the application's logs


## Prepare the `manifest.yml` file

Open the `manifest.yml` file and rename the `"Message Hub-CHANGEME"` entry to that of your own Message Hub Service Instance name.

```
  services:
    - "<your service name>"
```

You can optionally change the application's name:

```
- name: kafka-nodejs-console-sample
```

## Deploying and running the sample on the IBM Cloud

Connect to IBM Cloud® with the Cloud Foundry Command Line Interface. You might need to navigate to the Cloud Foundry Organization and Space your Message Hub instance has been provisoned in. Use `ibmcloud target -cf` to do this interactively.

When in the right Organisation and Space, run the following command in the same directory as the `manifest.yml` file, run the following to push out the application into the IBM Cloud:

```shell
ibmcloud cf push
```

You should see the application built and started.

## View the logs: Sample Output

You can view the application by running, don't forget to change the application's name, should you have renamed it earlier:

```shell
ibmcloud app logs kafka-nodejs-console-sample
```

Below is a snippet of the output generated by the sample:

```
Topic mh-nodejs-console-sample-topic created
Existing topics:
[ { name: 'mh-nodejs-console-sample-topic',
    partitions: 1,
    retentionMs: '86400000',
    markedForDeletion: false } ]
The consumer has started
The producer has started
Topic object created with opts {"request.required.acks":-1}
Consumer obtained metadata: {"orig_broker_id":0,"orig_broker_name":"sasl_ssl://kafka01-prod01.messagehub.services.us-south.bluemix.net:9093/0","topics":[{"name":"mh-nodejs-console-sample-topic","partitions":[{"id":0,"leader":0,"replicas":[0,1,4],"isrs":[null,null,null,1]}]}],"brokers":[{"id":2,"host":"kafka03-prod01.messagehub.services.us-south.bluemix.net","port":9093},{"id":4,"host":"kafka05-prod01.messagehub.services.us-south.bluemix.net","port":9093},{"id":1,"host":"kafka02-prod01.messagehub.services.us-south.bluemix.net","port":9093},{"id":3,"host":"kafka04-prod01.messagehub.services.us-south.bluemix.net","port":9093},{"id":0,"host":"kafka01-prod01.messagehub.services.us-south.bluemix.net","port":9093}]}
Producer obtained metadata: {"orig_broker_id":0,"orig_broker_name":"sasl_ssl://kafka01-prod01.messagehub.services.us-south.bluemix.net:9093/0","topics":[{"name":"mh-nodejs-console-sample-topic","partitions":[{"id":0,"leader":0,"replicas":[0,1,4],"isrs":[null,null,null,1]}]}],"brokers":[{"id":2,"host":"kafka03-prod01.messagehub.services.us-south.bluemix.net","port":9093},{"id":4,"host":"kafka05-prod01.messagehub.services.us-south.bluemix.net","port":9093},{"id":1,"host":"kafka02-prod01.messagehub.services.us-south.bluemix.net","port":9093},{"id":3,"host":"kafka04-prod01.messagehub.services.us-south.bluemix.net","port":9093},{"id":0,"host":"kafka01-prod01.messagehub.services.us-south.bluemix.net","port":9093}]}
Message produced, offset: 1
No messages consumed
Message produced, offset: 2
Message consumed: topic=mh-nodejs-console-sample-topic, partition=0, offset=1, key=key, value=This is a test message #1
Message produced, offset: 3
Message consumed: topic=mh-nodejs-console-sample-topic, partition=0, offset=2, key=key, value=This is a test message #2
Message produced, offset: 4
Message consumed: topic=mh-nodejs-console-sample-topic, partition=0, offset=3, key=key, value=This is a test message #3
```

## Further references

If you are unfamiliar with Cloud Foundry applications or Liberty then you might find the following documents useful:

[Cloud Foundry manifest documentation](http://docs.cloudfoundry.org/devguide/deploy-apps/manifest.html)
